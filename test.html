<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      #messages {
        border: 1px solid #ccc;
        height: 200px;
        overflow-y: scroll;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <h1>WebSocket Test Page</h1>
    <div id="messages"></div>
    <input id="userId" type="text" placeholder="User ID" />
    <input id="messageInput" type="text" placeholder="Type a message" />
    <button id="sendButton">Send</button>
    <button id="connect">Connect</button>

    <script>
      let websocket;

      document.getElementById("sendButton").onclick = () => {
        const userId = document.getElementById("userId").value;
        const message = document.getElementById("messageInput").value;

        if (!websocket || websocket.readyState !== WebSocket.OPEN) {
          alert("Please connect first!");
          return;
        }

        websocket.send(message);
        document.getElementById("messageInput").value = ""; // Clear input
      };

      document.getElementById("connect").onclick = () => {
        const userId = document.getElementById("userId").value;

        // Close existing connection if open
        if (websocket) {
          websocket.close();
        }

        // Create a new WebSocket connection
        websocket = new WebSocket(`ws://localhost/ws/${userId}`);

        // const sendPing = () => {
        //   if (websocket.readyState === WebSocket.OPEN) {
        //     socket.send(`player_id: ${userId || "unknown"}`);

        //     responseTimeout = setTimeout(() => {
        //       toast.error("No response received from the WebSocket.");
        //       clearTimeout(responseTimeout);
        //       if (onNoResponse) onNoResponse();
        //       socket.close();
        //     }, 6000); // Timeout for the response
        //   }
        // };

        let pingInterval = setInterval(() => {
          if (ws.readyState === WebSocket.OPEN) {
            ws.send("ping");
          }
        }, 6000);

        websocket.onopen = () => {
          appendMessage("Connected to WebSocket!");
        };

        websocket.onmessage = (event) => {
          appendMessage(`Received: ${event.data}`);
        };

        websocket.onclose = () => {
          appendMessage("Disconnected from WebSocket.");
          clearInterval(pingInterval);
        };

        websocket.onerror = (error) => {
          appendMessage(`WebSocket error: ${error.message}`);
        };
      };

      function appendMessage(message) {
        const messagesDiv = document.getElementById("messages");
        messagesDiv.innerHTML += `<div>${message}</div>`;
        messagesDiv.scrollTop = messagesDiv.scrollHeight; // Scroll to the bottom
      }
    </script>
  </body>
</html>
